<?xml version="1.0" encoding="utf-8"?>

<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="init()" layout="absolute" width="948.6" height="656" horizontalScrollPolicy="off" verticalScrollPolicy="off">
	<mx:Style>
       	.myFontStyle { 
           	fontSize: 24;
      	}
    </mx:Style>
	
	<mx:Script>
		<![CDATA[
			import mx.controls.List;
			import mx.controls.Image;
			import mx.containers.Panel;
			import mx.managers.PopUpManager
			import mx.containers.ControlBar;
            import mx.containers.VBox;
            import mx.controls.Button;
            import mx.controls.Label;
            import mx.controls.Spacer;
            import mx.controls.TextInput;
            import mx.collections.ArrayCollection;
            import mx.collections.XMLListCollection;
            
            private var OKButton:Button = new Button();
			private var dropdown:ComboBox = new ComboBox();
			private var browserPanel:Panel = new Panel();
	
			private var newFolderPanel:Panel;
			[Bindable] private var nameInput:TextInput = new TextInput();
			private var openSequence:Array = [];
			[Bindable] public var myJobs:XML =
            <root label = "My Jobs" isBranch ="true">
            </root>;
            
            [Bindable] public var myDocs:XML =
            <root label = "My Documents" isBranch = "true">
            </root>;

			[Bindable] public var selectedFolder:XML;

			[Embed(source="Pictures/calendar.jpg")]
			public var calendarpicture:Class;
			[Embed(source="Pictures/calendar.jpg")]
			public var docpicture:Class;
			[Embed(source="Pictures/calendar.jpg")]
			public var briefcasepicture:Class;
			[Embed(source="Pictures/calendar.jpg")]
			public var folderpicture:Class;
            public var fileThingy:List = new List();
			
			private function init():void{
				
				newFolderPanel=new Panel();
				newFolderPanel.title="New Folder";
				newFolderPanel.visible=true;
				var vb:VBox = new VBox();
                var nameLabel:Label = new Label();;
                var cb:ControlBar = new ControlBar();
                var s:Spacer = new Spacer();
                var saveButton:Button = new Button();
                var cancelButton:Button = new Button();
                s.percentWidth = 100;
                saveButton.label = "Save";
                saveButton.addEventListener(MouseEvent.CLICK, saveFolder);
                cancelButton.label = "Cancel";
                cancelButton.addEventListener(MouseEvent.CLICK, closePopUpNF);
                cb.addChild(s);
                cb.addChild(saveButton);
                cb.addChild(cancelButton);
                nameLabel.text = "New Folder Name:";
                vb.setStyle("paddingBottom", 5);
                vb.setStyle("paddingLeft", 5);
                vb.setStyle("paddingRight", 5);
                vb.setStyle("paddingTop", 5);
                vb.addChild(nameLabel);
                vb.addChild(nameInput);
                nameInput.width=200;
                newFolderPanel.width = 240;
                newFolderPanel.height = 140;
                newFolderPanel.addChild(vb);
                newFolderPanel.addChild(cb);
                
				browserPanel.width = 300;
				browserPanel.height = 200;
				browserPanel.title="Select Document to Add...";
				browserPanel.visible=true;
				var cb2:ControlBar = new ControlBar();
				var s2:Spacer = new Spacer();
                s2.percentWidth = 100;				
				var selectButton:Button=new Button();
				selectButton.label = "Choose";
                selectButton.addEventListener(MouseEvent.CLICK, saveNewDoc);
                var cancelmeButton:Button = new Button();
                cancelmeButton.label = "Cancel";
                cancelmeButton.addEventListener(MouseEvent.CLICK, closePopUpB);   
                var options:Array = new Array("Resume");
                fileThingy.dataProvider = options;      
                var vb2:VBox = new VBox();  
                vb2.setStyle("paddingBottom", 5);
                vb2.setStyle("paddingLeft", 5);
                vb2.setStyle("paddingRight", 5);
                vb2.setStyle("paddingTop", 5);
                vb2.addChild(fileThingy);
                fileThingy.height=100;
                fileThingy.width=200;
                cb2.addChild(s);
                cb2.addChild(selectButton);
                cb2.addChild(cancelmeButton);
                browserPanel.addChild(vb2);
                browserPanel.addChild(cb2);
                
                
                
				dropdown.dataProvider = fieldlist;
				dropdown.styleName="myFontStyle";
				dropdown.id="dropdown";

				OKButton.styleName="myFontStyle";
				OKButton.label="OK";
				OKButton.addEventListener(MouseEvent.CLICK, selectNewField);
            
			}
			
			private function saveNewDoc(evt:MouseEvent):void{
				docfile.text=fileThingy.selectedItem.toString();
				trace("saved new doc name");
				PopUpManager.removePopUp(browserPanel);
			}
			
		    private function newBrowseWindow(evt:MouseEvent):void{
		    	PopUpManager.addPopUp(browserPanel, this, true);
                PopUpManager.centerPopUp(browserPanel);
		    }


			private function saveFolder(evt:MouseEvent):void {
				
				
							
				if(viewstack1.selectedChild.label == "Positions"){
					selectedFolder = jobTree.selectedItem as XML;
					if(selectedFolder != null){
    					selectedFolder.appendChild(<folder id = {nameInput.text} label = {nameInput.text} isBranch = "true"/>);				
    				}
    				else{
                		myJobs.appendChild(<folder id = {nameInput.text} label = {nameInput.text} isBranch = "true"/>);
                		}
    			}
    			
    			if(viewstack1.selectedChild.label == "Documents"){
    				selectedFolder = docTree.selectedItem as XML;
    				if(selectedFolder != null){
    					selectedFolder.appendChild(<folder id = {nameInput.text} label = {nameInput.text} isBranch = "true"/>);				
    				}
    				else{
                		myDocs.appendChild(<folder id = {nameInput.text} label = {nameInput.text} isBranch = "true"/>);
                		}
                	
    			}
    			
    			nameInput.text = "";
                PopUpManager.removePopUp(newFolderPanel);
            }
			
			private function closePopUpNF(evt:MouseEvent):void {
                PopUpManager.removePopUp(newFolderPanel);
                nameInput.text = "";
            }
            
            private function closePopUpB(evt:MouseEvent):void {
            	trace("closing browse window");
                PopUpManager.removePopUp(browserPanel);
            }
			
			private function getFolderPopUp(event:MouseEvent):void{
				PopUpManager.addPopUp(newFolderPanel, this, true);
                PopUpManager.centerPopUp(newFolderPanel);
			}
		]]>
	</mx:Script>
	<mx:ViewStack x="10" y="10" id="viewstack1" width="926" height="626">
		<mx:Canvas label="Calendar" width="100%" height="100%" horizontalScrollPolicy="off" verticalScrollPolicy="off" icon="@Embed(source='Pictures/calpic.jpg')">
			<mx:Image x="0" y="92" width="557" height="534">
				<mx:source>Pictures/calendar.png</mx:source>
			</mx:Image>
			<mx:ViewStack x="565" y="92" id="viewstack3" width="351" height="524">
				<mx:Canvas label="View 1" width="100%" height="100%">
				</mx:Canvas>
			</mx:ViewStack>
			<mx:TitleWindow x="565" y="92" width="351" height="524" layout="absolute" title="To Do:" fontSize="20">
				<mx:CheckBox x="10" y="20" label="Add a Job" width="311"/>
			</mx:TitleWindow>
			<mx:Text x="296" y="10" text="Welcome to PathFinder!" fontSize="50" color="#497AD2" width="556" fontFamily="Georgia"/>
		</mx:Canvas>
		<mx:Canvas label="Documents" width="120%" height="100%" horizontalScrollPolicy="off" visible="true" verticalScrollPolicy="off" icon="@Embed(source='Pictures/docpicturesm.jpg')">
			<mx:Button x="0" y="589" label="Add Folder" width="124" click="getFolderPopUp(event)" fontSize="14"/>
			<mx:Button x="141" y="589" label="Add Doc" width="124" click="documentpane.selectedChild=addDoc;" fontSize="14"/>
			<mx:ViewStack x="273" y="10" id="documentpane" width="643" height="606">
			<mx:Canvas id = "initialdoc" label="Initial" width="100%" height="100%">
			</mx:Canvas>
			<mx:Canvas id = "addDoc" label="AddDoc" width="100%" height="100%" horizontalScrollPolicy="off" verticalScrollPolicy="off">
					<mx:TitleWindow x="0" y="0" width="643" height="554" layout="absolute" title="Add a Document" horizontalScrollPolicy="off" verticalScrollPolicy="on" fontSize="34" fontFamily="Times New Roman" verticalAlign="middle" horizontalAlign="center" >
						<mx:Label x="10" y="10" text="Title:" fontSize="18"/>
						<mx:TextInput x="109" y="10" width="488" height="32" fontSize="18" id="doctitle"/>
						<mx:Label x="10" y="50" text="Description:" fontSize="18"/>
						<mx:TextInput x="109" y="48" width="488" height="103" fontSize="18" id="docdescription"/>
						<mx:Label x="10" y="161" text="File:" fontSize="18"/>
						<mx:TextInput x="109" y="159" height="32" width="225" fontSize="18" id="docfile"/>
						<mx:Button x="342" y="170" label="Browse..." fontSize="20" click="newBrowseWindow(event)"/>
					</mx:TitleWindow>
					<mx:Button x="10" y="562" label="Save" fontSize="20" width="97" click = "saveDoc()"/>
					<mx:Button x="115" y="562" label="Cancel" fontSize="20" click="cancelDoc()"/>
					<mx:Button x="222" y="562" label="Clear All" fontSize="20" click = "clearDocFields()"/>
				</mx:Canvas>
			</mx:ViewStack>
			<mx:Tree id = "docTree" x="0" y="88" width="265" height="498" doubleClickEnabled = "true" showRoot="true" labelField="@label" dragEnabled="true" dropEnabled="true" dataProvider="{myDocs}">	

			</mx:Tree>
			
		</mx:Canvas>
		<mx:Canvas label="Positions" width="100%" height="100%" horizontalScrollPolicy="off" verticalScrollPolicy="off" icon="@Embed(source='Pictures/briefcasepic.jpg')">
			<mx:Button x="0" y="589" label="Add Folder" width="124" click="getFolderPopUp(event)" fontSize="14"/>
			<mx:Button x="141" y="589" label="Add Job" width="124" click="jobpane.selectedChild=addJob;" fontSize="14"/>
			<mx:ViewStack x="273" y="10" id="jobpane" width="643" height="606">
				<mx:Canvas id = "initialjob" label="Initial" width="100%" height="100%">
				</mx:Canvas>
				<mx:Canvas id = "addJob" label="addJob" width="100%" height="100%" horizontalScrollPolicy="off" verticalScrollPolicy="off" >
					<mx:TitleWindow x="0" y="0" id="jobwindow" width="643" height="554" layout="absolute" title="Add a Job" fontSize="34" horizontalScrollPolicy="off" verticalScrollPolicy="on" fontFamily="Times New Roman" verticalAlign="middle" horizontalAlign="center">

						<mx:TextInput x="137" y="10" width="444" height="31" fontSize="18" id="jobcompany"/>
						<mx:Label x="10" y="10" text="Company:" height="31" width="119" fontSize="18"/>
						<mx:Label x="10" y="49" text="Title:" id="sizeref" fontSize="18" height="32"/>
						<mx:TextInput x="137" y="49" width="444" height="32" fontSize="18" id="jobtitle"/>
						<mx:TextInput x="137" y="138" width="444" height="112" fontSize="18" id="jobrequirements"/>
						<mx:Text x="10" y="129" text="Requirements &#xd;for Application:" width="119" height="65" fontSize="18" textAlign="left"/>
						<mx:Button x="10" y="258" id = "addbutton" label="Add Another Field" fontSize="20" click="addField()"/>
						<mx:DateField showToday = "true" x="137" y="89" height="32" fontSize="18" id="jobdeadline" width="148"/>
						<mx:Label x="10" y="91" text="Deadline:" width="97" height="32" fontSize="18"/>
					</mx:TitleWindow>
					<mx:Button x="10" y="562" label="Save" fontSize="20" width="97" click="saveJob()" />
					<mx:Button x="115" y="562" label="Cancel" fontSize="20" click="cancelJob()"/>
					<mx:Button x="222" y="562" label="Clear All" fontSize="20" click = "clearJobFields()"/>
				</mx:Canvas>
			</mx:ViewStack>
			<mx:Tree id = "jobTree" x="0" y="88" width="265" height="498" doubleClickEnabled = "true" showRoot="true" labelField="@label" dragEnabled="true" dropEnabled="true" dataProvider="{myJobs}">	

			</mx:Tree>
		</mx:Canvas>
	</mx:ViewStack>
	<mx:ToggleButtonBar x="10" y="10">
	</mx:ToggleButtonBar>
	<mx:ToggleButtonBar dataProvider="viewstack1" labelField="icon" height="85" width="264" horizontalCenter="-331" verticalCenter="-271">
	</mx:ToggleButtonBar>
	
	<mx:Script>
		<![CDATA[
			import mx.controls.DateChooser;
			import mx.controls.Text;
			import mx.controls.List;
			import mx.controls.ComboBox;
			import model.Doc;
			import model.Job;
			import mx.binding.utils.BindingUtils;
			
			public var fieldlist:Array= new Array("Interview Date","Recommendation","Recruiter Info");
			
			private function addField():void {
				jobwindow.addChild(dropdown);
				dropdown.x=10;
				dropdown.y=addbutton.y;
				addbutton.y = addbutton.y+50;

				jobwindow.addChild(OKButton);
				OKButton.x=250
				OKButton.y=dropdown.y
				
				
			}


			private function selectNewField(event:MouseEvent):void{
				if (dropdown.selectedItem=="Interview Date") {
					jobwindow.removeChild(OKButton);
					
					var date:Label = new Label();
					date.text="Date:";
					date.styleName="myFontStyle";
					jobwindow.addChild(date);	
					date.x=150;
				    date.y=dropdown.y;
					var datechoose:DateField=new DateField();
					datechoose.styleName="myFontStyle";
					jobwindow.addChild(datechoose);
					datechoose.x=225;
					datechoose.y = dropdown.y;
					addbutton.y = addbutton.y+60;
					
					var time:Label = new Label();
					time.text="Time:";
					time.styleName="myFontStyle";
					jobwindow.addChild(time);	
					time.x=375;
				    time.y=dropdown.y;
				    var Tinput:TextInput = new TextInput();
					Tinput.styleName="myFontStyle";
					jobwindow.addChild(Tinput);
					Tinput.x=435;
					Tinput.y=dropdown.y;
				    
				    
				    var place:Label = new Label();
					place.text="Place:";
					place.styleName="myFontStyle";
					jobwindow.addChild(place);	
					place.x=150;
				    place.y=dropdown.y+50;
					var Pinput:TextInput = new TextInput();
					Pinput.styleName="myFontStyle";
					jobwindow.addChild(Pinput);
					Pinput.x=225;
					Pinput.y=dropdown.y+50;
				    
					var interviewdatetext:Label = new Label();
					interviewdatetext.text="Interview:";
					interviewdatetext.styleName="myFontStyle";
					jobwindow.addChild(interviewdatetext);	
					interviewdatetext.x=dropdown.x;
					interviewdatetext.y=dropdown.y;
					jobwindow.removeChild(dropdown);			
				}
				else if (dropdown.selectedItem!=" "){
					jobwindow.removeChild(OKButton);
					var input:TextInput = new TextInput();
					input.styleName="myFontStyle";
					jobwindow.addChild(input);
					input.x=250;
					input.y=dropdown.y;	
					var textlabel:Label = new Label();
					textlabel.text=dropdown.selectedItem.toString();
					textlabel.styleName="myFontStyle";
					jobwindow.addChild(textlabel);	
					textlabel.x=dropdown.x;
					textlabel.y=dropdown.y;
					jobwindow.removeChild(dropdown);			
				}
				
			}
			

			[Bindable] private var selectedNode:XML;
			[Bindable] private var jobList:Array = new Array();
			[Bindable] private var docList:Array = new Array();
			[Bindable] private var editing:Boolean = false;
			[Bindable] private var index:int;

			private function saveJob():void {
				jobpane.selectedChild=initialjob;
				var job:Job = new Job();
				job.company = jobcompany.text;
				job.title = jobtitle.text;
				job.requirements = jobrequirements.text;
				job.deadline = jobdeadline.selectedDate;
				selectedNode = jobTree.selectedItem as XML;
				if(selectedNode != null && !selectedNode.child("job")){
				selectedNode = myJobs;}
				if(selectedNode == null ){
					selectedNode = myJobs;
					
									
				
				}

//				if(editing == true){
//				 	for (var i:int = 0; i< myJobs.length(); ++i)
//					{
//						
//						if(myJobs.item[i].attribute("label") == selectedNode.attribute("label"))
//					{
//						delete myJobs.item[i];
//						trace("hello")
//					}
//					}
//					trace(myJobs);
//				}
				selectedNode.appendChild(<job id = {job.company} label = {job.company}/>);
				jobList.push(job);
				jobcompany.text = "";
				jobtitle.text = "";
				jobrequirements.text = "";
				jobdeadline.text = "";
				
				editing = false;
            	jobTree.addEventListener(MouseEvent.DOUBLE_CLICK, doubleClickJob);
				
			}
			
						
			private function doubleClickJob(evt:MouseEvent):void{
				
				editing = true;
				selectedNode = jobTree.selectedItem as XML;
				var parent:XML = selectedNode.parent();
				jobpane.selectedChild=addJob;
				jobcompany.text = selectedNode.attribute("label");
				var selectedJob:Job;
				trace(jobcompany.text);
				for (var i:int = 0; i < jobList.length; ++i){
					var job:Job = jobList[i];
					
					if(job.company == jobcompany.text){
						selectedJob = job;
						index = jobList.indexOf(job);
					}
				}	
				
				jobcompany.text = selectedJob.company;
				jobtitle.text = selectedJob.title;
				jobrequirements.text = selectedJob.requirements;
				jobdeadline.selectedDate = selectedJob.deadline;
				
				
				
			}
			
			private function doubleClickDoc(evt:MouseEvent):void{
				
				
				selectedNode = docTree.selectedItem as XML;
				documentpane.selectedChild=addDoc;
				doctitle.text = selectedNode.attribute("label");
				var selectedDoc:Doc;
				for (var i:int = 0; i < docList.length; ++i){
					var doc:Doc = docList[i];
					if(doc.title == doctitle.text){
						selectedDoc = doc;
					}
				}	
				
				doctitle.text = selectedDoc.title;
				docdescription.text = selectedDoc.description;
				docfile.text = selectedDoc.file;
				
			}
			
			private function saveDoc():void {
				documentpane.selectedChild=initialdoc;
				var doc:Doc = new Doc();
				doc.title = doctitle.text;
				doc.description = docdescription.text;
				doc.file = docfile.text;
				selectedNode = docTree.selectedItem as XML;
				if(selectedNode == null){
					selectedNode = myDocs;
				}
				selectedNode.appendChild(<doc label = {doc.title}/>);
				docList.push(doc);
				doctitle.text = "";
				docdescription.text = "";
				docfile.text = "";
				
				docTree.addEventListener(MouseEvent.DOUBLE_CLICK, doubleClickDoc);
			}
			
			private function clearDocFields():void {
				doctitle.text = "";
				docdescription.text = "";
				docfile.text = "";
			}
			
			private function clearJobFields():void {
				jobcompany.text = "";
				jobtitle.text = "";
				jobrequirements.text = "";
				jobdeadline.text = "";
			}
			
			private function cancelDoc():void {
				documentpane.selectedChild=initialdoc;
				doctitle.text = "";
				docdescription.text = "";
				docfile.text = "";
			}
			
			private function cancelJob():void {
				jobpane.selectedChild=initialjob;
				jobcompany.text = "";
				jobtitle.text = "";
				jobrequirements.text = "";
				jobdeadline.text = "";
			}
		
		]]>
	</mx:Script>
	
</mx:WindowedApplication>
